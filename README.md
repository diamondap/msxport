# msxport

A set of SQL scripts for exporting databases from SQL Server to Postgres.
The scripts include procedures and functions to export tables, indexes,
and foreign keys by examining the structure of the SQL database and 
generating the appropriate DDL statements to re-create those objects in
Postgres.

In addition, these scripts will generate appropriate commands to export data
from all tables in a SQL Server database to tab-delimited text. (This has 
some limitations-- see below. But it's much easier than defining 100 SSIS
export packages one by one, which is how SSIS forces you to define exports
to text files.)

The SQL scripts are designed to be run either directly in SQL Server Management
Studio, or to be executed by the language of your choice. You will not need
to install any additional software to use the scripts.

For information on usage, see the comments in sql/ms2pg_export_tools.sql.
It's designed to be as simple and straight-forward as possible. Keep in mind
that when you bring the schema and data into Postgres, it's best to do the
import in this order:

1. Create tables.
2. Import data.
3. Create indexes.
4. Create foreign keys.

Importing data before creating indexes and foreign keys makes the import 
go much faster. In most cases, you must define the indexes before you define
the foreign keys, so that Postgres doesn't complain about a foreign key 
refering to a non-unique column.

ms2pg_export_tools.sql can easily be adapted to export to MySQL, Sqlite, or
other databases. 

## Limitations

ms2pg_export_tools.sql will export tables, indexes and foreign keys. It does
not export functions, triggers, custom check constraints, or views. Views are
relatively easy to port from SQL server, but you typically must change 
brackets to double quotes and alter computed columns to use functions that
Postgres understands.

If you use the sqlcmd commands generated by pg_get_export_commands or
pg_print_export_commands, you should be aware of the following issues:

1. The export deletes embedded tabs and newlines from all varchar and
   text fields.
2. The export limits the width of each column to 65535 characters. Longer
   text fields will be truncated.
3. This has not been tested with binary data.
4. When importing to Postgres, you may occasionally see messages about an
   integer field or a UUID being improperly formatted. This is due to Windows 
   adding a byte order marker (BOM) to the beginning of the UTF-8 file. Here
   are some ways to remove the BOM: 
   http://www.linuxask.com/questions/how-to-remove-bom-from-utf-8
5. If any column of exported data ends with a backslash, Postgres will complain
   that a record is missing a column. You have to manually delete any
   trailing backslashes.

The export commands use sqlcmd instead of bcp because bcp embeds null bytes
into the exported text files, and Postgres will not read these. As far as I
know, bcp provides no way around this issue.
